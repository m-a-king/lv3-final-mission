# LV3 최종미션, 인프라 구축

## 필수 요구사항
애플리케이션을 AWS에 배포 가능한 상태로 구축해야 한다.
애플리케이션 서버와 데이터베이스 서버를 물리·네트워크 계층에서 분리해야 한다.
개발(dev)과 운영(prod)의 설정을 서로 독립적으로 관리·배포해야 한다.

## 추가 요구사항(선택)
소스 변경 시 자동 빌드·배포가 수행되도록 파이프라인을 구성해야 한다.
개인 도메인을 애플리케이션에 연결하고 HTTPS를 적용해야 한다.
애플리케이션 로그를 파일 또는 수집기로 영속화하고 조회 절차를 제공해야 한다.
서버 자원(CPU·메모리·네트워크 등)을 지표·대시보드로 시각화해야 한다.
운영 중 스키마 변경 시 데이터 보존 상태로 마이그레이션 및 재배포를 완료해야 한다.
제공 API의 문서 명세를 작성·공개해야 한다.
전체 인프라를 다이어그램으로 작성하고 각 구성요소 역할을 설명해야 한다.

---

- **시간 제약 5시간** → 가성비에 집중
  
- **환경 전략**
  - 로컬 = dev
  - EC2-dev = prod

- **인프라 구성**
  - EC2(퍼블릭 서브넷): Nginx + Certbot + Docker(Spring)
  - RDS(프라이빗 서브넷): 퍼블릭 접근 차단, SG로 EC2만 허용
  - DNS: gangsan.woowacourse.com (thx 후유)

- **리버스 프록시/보안**
  - Docker 포트 바인딩 `127.0.0.1:8080:8080` 로 외부 직접 접속 차단
  - Nginx 443에서 TLS 종료, `proxy_pass http://127.0.0.1:8080` 내부 전달
  - 외부 노출 면적 80/443(Nginx)로 최소화, 앱 포트 비공개화

- **Certbot**
  - 호스트에서 실행되는 ACME 클라이언트, 발급/갱신 시에만 개입

- **CI/CD**
  - **Docker**
    - Docker Hub에 태그(예: `latest`, 커밋 short SHA)로 푸시, 배포 아티팩트 일원화
    - `docker/build-push-action@v6`로 **multi-arch(amdn64/arm64)** 이미지 빌드·푸시 -> EC2 인스턴스 변화에 대응 가능
  - **배포 절차**
    - Self-hosted runner(EC2)에서 docker compose 활용
    - 이미지 풀 후 무중단에 준하는 재기동
  - **프로파일 기반 설정 일관성**
    - 런타임에 `SPRING_PROFILES_ACTIVE=<profile>`(예: `local`, `dev`)만 지정하면 동일한 프로파일 키로 **세 계층**이 자동 정렬됨 → 환경변수는 `.env.<profile>`에서 주입, 스프링 설정은 `application-<profile>.yml` 로드, 배포는 `docker-compose.<profile>.yml` 사용 → 한 지점에서 프로파일만 바꿔도 **환경·애플리케이션·배포 구성이 논리적으로 분리·연동**
  - **Self-hosted runner 사용 이유**
    - EC2가 **퍼블릭 서브넷**에 있으나 **보안그룹/네트워크 정책상 외부(공용망)에서 ssh 포트 접근 불가**, 사실상 우아코스 Wi-Fi 등 제한된 경로만 허용
      - SaaS 러너가 직접 접근 불가
    - Self-hosted runner가 **외부로 폴링(outbound)** 하여 GitHub Actions 작업을 가져오는 모델이므로 인바운드 비개방 환경에서 적합
